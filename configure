#!/bin/sh
BUILDINFO=mlir-hs-tblgen.buildinfo

# Setup .buildinfo
echo "--Autogenerated file. $(date)" > ${BUILDINFO} 
if ! command -v llvm-config &> /dev/null
then
    echo "buildable: False" >> ${BUILDINFO}
    exit
fi

echo "cxx-options:" >> ${BUILDINFO}
echo "$(llvm-config --cxxflags | sed -e 's/-I[\/A-Za-z0-9.]* //g' | sed -e 's/ *//' | sed -e 's/  */\n/g' | sed -e 's/^/    /g')" >> ${BUILDINFO}

echo "cc-options:" >> ${BUILDINFO}
echo "$(llvm-config --cflags | sed -e 's/-I[\/A-Za-z0-9.]* //g' | sed -e 's/ *//' | sed -e 's/  */\n/g' | sed -e 's/^/    /g')" >> ${BUILDINFO}

echo "ld-options:" >> ${BUILDINFO}
echo "$(llvm-config --ldflags | sed -e 's/-L[\/A-Za-z0-9.]* //g' | sed -e 's/ *//' | sed -e 's/  */\n/g' | sed -e 's/^/    /g')" >> ${BUILDINFO}

echo "extra-lib-dirs:" >> ${BUILDINFO}
echo "$(llvm-config --libdir | sed -e 's/  */\n/g' | sed -e 's/^/    /g')" >> ${BUILDINFO}

echo "include-dirs:" >> ${BUILDINFO}
echo "$(llvm-config --includedir | sed -e 's/  */\n/g' | sed -e 's/^/    /g')" >> ${BUILDINFO}
